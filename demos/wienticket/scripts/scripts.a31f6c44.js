"use strict";angular.module("wienticketApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","uiGmapgoogle-maps","ngScrollTo","angularMoment"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).config(["uiGmapGoogleMapApiProvider",function(a){a.configure({v:"3.17",libraries:"weather,geometry,visualization"})}]).run(["$rootScope","$anchorScroll","amMoment",function(a,b,c){c.changeLocale("de"),moment.locale("de",{calendar:{sameDay:"[heute], dddd D. MMMM 'YY",sameElse:"dddd, D. MMMM 'YY",nextDay:"[morgen], dddd D. MMMM 'YY",nextWeek:"[n√§chsten] dddd, D. MMMM 'YY",lastDay:"[gestern], dddd D. MMMM 'YY",lastWeek:"[letzten] dddd, D. MMMM 'YY"}}),a.$on("$routeChangeSuccess",function(){b()})}]),angular.module("wienticketApp").controller("MainCtrl",["$scope","$rootScope","events","categories","ScrollTo",function(a,b,c,d,e){c.load().then(function(){a.events=c.grouped(),a.rawData=c.data}),d.load().then(function(){a.categories=d.data}),a.$watch(function(){return c.data},function(){var a=_.find(c.data,function(a){return a.highlight});if(a){var b=a.id.value;e.idOrName("id"+b,450)}},!0),a.filterByDate=function(d){b.loading=!0,c.filterByDate(d).finally(function(){b.loading=!1,a.events=c.grouped()})},a.isDisabled=function(a){return c.isDisabled(a)},a.$watch(function(){return c.config.currentCategoryFiltering},function(b){a.filteredCategory=b}),a.$watch("filteredCategory",function(){b.loading=!0,c.filterByCategory(a.filteredCategory).finally(function(){b.loading=!1,a.events=c.grouped()})})}]),_.mixin({groupByMulti:function(a,b,c){if(!b.length)return a;var d=_.groupBy(a,b[0],c),e=b.slice(1);for(var f in d)d[f]=_.groupByMulti(d[f],e,c);return d}}),angular.module("wienticketApp").service("events",["$rootScope","$http","$q","$httpBackend",function(a,b,c){var d=function(b){a.$$phase||a.$root.$$phase?b():a.$apply(b)},e={currentDuration:"today",currentCategoryFiltering:void 0},f=function(){var a,b;a="week"==e.currentDuration?7:"month"==e.currentDuration?30:1,b=moment().add(a,"days").format("YYYY-MM-DD");var c="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>    PREFIX schema: <http://schema.org/>    PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>    PREFIX wto: <http://data.redlink.io/1/wien-tickets/vocab#>    PREFIX dct: <http://purl.org/dc/terms/>    SELECT ?id ?uri ?title ?category ?start ?end ?sales ?venue ?address ?link ?lat ?lon    WHERE {      ?uri a schema:Event ;             rdfs:label ?title ;             dct:identifier ?id ;             schema:category [ rdfs:label ?category ] ;             schema:startDate ?start ;             schema:endDate ?end ;             wto:endSelling ?endSelling ;             schema:location ?venue ;             schema:address ?address ;             schema:url ?link ;             geo:lat ?lat ;             geo:long ?lon .      BIND (?endSelling > now() AS ?sales) ";return e.currentCategoryFiltering&&(c+="FILTER (?category = '"+e.currentCategoryFiltering+"'@de) "),c+="FILTER (?start > now() && ?start < '"+b+"'^^xsd:date) }      ORDER BY ASC(?start)"},g=[],h=function(){a.loading=!0;var d=c.defer(),e="https://api.redlink.io/1.0-BETA/data/wien-tickets/sparql/select?key=ZU8d924y7DokQkoyI2yrSlSeMiCFmobW1ed653b4&out=json",h=f();return b.post(e,h).success(function(a){g.length=0,[].push.apply(g,a.results.bindings),d.resolve(g)}).error(function(a){d.reject(a)}).finally(function(){a.loading=!1}),d.promise};return{load:h,data:g,config:e,grouped:function(){return _.groupByMulti(g,[function(a){return a.start.value.substring(0,10)},function(a){return a.category.value}])},highlight:function(a){d(function(){var b=!a.highlight;_.each(g,function(a){a.highlight=!1}),a.highlight=b})},filterByDate:function(a){return e.currentDuration=a,h()},isDisabled:function(a){return a==e.currentDuration},filterByCategory:function(a){return e.currentCategoryFiltering=a,h()}}}]),angular.module("wienticketApp").service("categories",["$http","$q",function(a,b){var c=[],d=["X-MAS","Pop/Rock","Jazz","Kabarett","Musical","Show","Familie","Klassiker/Theater","Schlager","Sport"],e={"X-MAS":"#E51790","Pop/Rock":"#C22120",Jazz:"#893923",Kabarett:"#EC7800",Musical:"#FBC000",Show:"#58AD23",Familie:"#51543E","Klassiker/Theater":"#59C0DB",Schlager:"#3A6584",Sport:"#812889"},f=function(){var e=b.defer(),f="https://api.redlink.io/1.0-BETA/data/wien-tickets/sparql/select?key=ZU8d924y7DokQkoyI2yrSlSeMiCFmobW1ed653b4&out=json",g="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX schema: <http://schema.org/> SELECT DISTINCT ?category WHERE { ?event a schema:Event ; schema:category [ rdfs:label ?category ] ; }";return a.post(f,g).success(function(a){var b=_.map(a.results.bindings,function(a){return a.category.value});b=_.uniq(b.concat(d)),c.length=0,[].push.apply(c,b),e.resolve(c)}).error(function(a){e.reject(a)}),e.promise};return{load:f,data:c,baseCategories:d,colorMapping:e}}]),angular.module("wienticketApp").directive("map",["events","uiGmapGoogleMapApi","uiGmapLogger","$timeout",function(a,b,c,d){return{templateUrl:"scripts/directives/map/map.drctv.html",replace:!1,restrict:"E",link:function(e){e.events=a.data,e.map={center:{latitude:48.203,longitude:16.3556},zoom:8},e.showAllMarkers=!0,e.markers=[],e.$watchCollection("events",function(){e.markers=[],_.each(a.data,function(a){var b={id:a.uri.value,event:a,coords:{latitude:a.lat.value,longitude:a.lon.value}};e.markers.push(b)})},!0);var f=function(a){a&&(a.setAnimation(3),d(function(){a.setAnimation(4)},260))},g=function(a){a&&a.getMap().panTo(a.getPosition())};e.highlight=function(b){b&&(f(b),a.highlight(b.model.event))},c.doLog=!0,b.then(function(){}),e.mapControl={},e.$watch("markers",function(){var a=_.find(e.markers,function(a){return a.event.highlight});if(a){var b=_.find(e.mapControl.getGMarkers(),function(b){return b.model==a});f(b),g(b)}},!0)}}}]),angular.module("wienticketApp").directive("headerNavigation",["categories","events","$rootScope",function(a,b,c){return{templateUrl:"scripts/directives/header-navigation/header-navigation.drctv.html",restrict:"E",replace:!0,scope:{},link:function(d){d.categories=a.baseCategories,d.filterCategory=function(a){c.loading=!0,b.filterByCategory(a).finally(function(){c.loading=!1})}}}}]),angular.module("wienticketApp").directive("event",["events",function(a){return{templateUrl:"scripts/directives/event/event.drctv.html",restrict:"E",scope:{event:"=ngModel"},link:function(b){b.highlight=function(){a.highlight(b.event)}}}}]),angular.module("wienticketApp").filter("getCategoryColor",["categories",function(a){return function(b){return a.colorMapping[b]}}]);